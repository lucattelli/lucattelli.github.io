/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./TableExtension','./TableUtils','sap/ui/Device','./library'],function(q,T,a,D,l){"use strict";var S=l.SharedDomRef;var H={onScroll:function(e){var s=this._getScrollExtension();q.sap.interaction.notifyScrollEvent&&q.sap.interaction.notifyScrollEvent(e);if(this._bOnAfterRendering){return;}var n=e.target.scrollLeft;var o=e.target._scrollLeft;if(n!==o){var d=H._getScrollAreas(this);e.target._scrollLeft=n;for(var i=0;i<d.length;i++){var f=d[i];if(f!==e.target&&f.scrollLeft!==n){f.scrollLeft=n;f._scrollLeft=n;}}s._iHorizontalScrollPosition=n;this._determineVisibleCols(this._collectTableSizes());}},restoreScrollPosition:function(t){var s=t._getScrollExtension();var h=s.getHorizontalScrollbar();if(h!==null&&s._iHorizontalScrollPosition!==null){var d=H._getScrollAreas(t);for(var i=0;i<d.length;i++){var o=d[i];delete o._scrollLeft;}if(h.scrollLeft!==s._iHorizontalScrollPosition){h.scrollLeft=s._iHorizontalScrollPosition;}else{var e=q.Event("scroll");e.target=h;H.onScroll.call(t,e);}}},addEventListeners:function(t){var s=t._getScrollExtension();var d=H._getScrollAreas(t);if(s._onHorizontalScrollEventHandler==null){s._onHorizontalScrollEventHandler=H.onScroll.bind(t);}for(var i=0;i<d.length;i++){d[i].addEventListener("scroll",s._onHorizontalScrollEventHandler);}},removeEventListeners:function(t){var s=t._getScrollExtension();var d=H._getScrollAreas(t);if(s._onHorizontalScrollEventHandler!=null){for(var i=0;i<d.length;i++){d[i].removeEventListener("scroll",s._onHorizontalScrollEventHandler);delete d[i]._scrollLeft;}delete s._onHorizontalScrollEventHandler;}},_getScrollAreas:function(t){var s=[t._getScrollExtension().getHorizontalScrollbar(),t.getDomRef("sapUiTableColHdrScr"),t.getDomRef("sapUiTableCtrlScr")];return s.filter(function(o){return o!=null;});}};var V={onScroll:function(e){var s=this._getScrollExtension();q.sap.interaction.notifyScrollEvent&&q.sap.interaction.notifyScrollEvent(e);if(s._bIsScrolledVerticallyByKeyboard){return;}this._getKeyboardExtension().setActionMode(false);function u(t){var v=t._getScrollExtension().getVerticalScrollbar();if(!v){return;}var i=v.scrollTop;s._iVerticalScrollPosition=i;var n=t._getFirstVisibleRowByScrollTop(i);var o=t.getFirstVisibleRow();var f=n!==o;if(f){t.setFirstVisibleRow(n,true);if(a.isVariableRowHeightEnabled(t)){t.attachEventOnce("_rowsUpdated",function(){this._adjustTablePosition(v.scrollTop,this._aRowHeights);});}}else if(a.isVariableRowHeightEnabled(t)){t._adjustTablePosition(i,t._aRowHeights);}}if(this._bLargeDataScrolling&&!s._bIsScrolledVerticallyByWheel){q.sap.clearDelayedCall(this._mTimeouts.scrollUpdateTimerId);this._mTimeouts.scrollUpdateTimerId=q.sap.delayedCall(300,this,function(){u(this);delete this._mTimeouts.scrollUpdateTimerId;}.bind(this));}else{u(this);}s._bIsScrolledVerticallyByWheel=false;},onScrollbarMouseDown:function(e){var s=this._getScrollExtension();s._bIsScrolledVerticallyByWheel=false;s._bIsScrolledVerticallyByKeyboard=false;},restoreScrollPosition:function(t){var s=t._getScrollExtension();if(s._iVerticalScrollPosition!==null){t._updateVSbScrollTop(s._iVerticalScrollPosition);}else{t._updateVSbScrollTop();}},addEventListeners:function(t){var s=t._getScrollExtension();var d=V._getScrollAreas(t);var v=s.getVerticalScrollbar();if(s._onVerticalScrollEventHandler==null){s._onVerticalScrollEventHandler=V.onScroll.bind(t);}for(var i=0;i<d.length;i++){d[i].addEventListener("scroll",s._onVerticalScrollEventHandler);}if(v!==null){if(s._onVerticalScrollbarMouseDownEventHandler==null){s._onVerticalScrollbarMouseDownEventHandler=V.onScrollbarMouseDown.bind(t);}v.addEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);}},removeEventListeners:function(t){var s=t._getScrollExtension();var d=V._getScrollAreas(t);var v=s.getVerticalScrollbar();if(s._onVerticalScrollEventHandler!=null){for(var i=0;i<d.length;i++){d[i].removeEventListener("scroll",s._onVerticalScrollEventHandler);}delete s._onVerticalScrollEventHandler;}if(v!==null&&s._onVerticalScrollbarMouseDownEventHandler!=null){v.removeEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);delete s._onVerticalScrollbarMouseDownEventHandler;}},_getScrollAreas:function(t){var s=[t._getScrollExtension().getVerticalScrollbar()];return s.filter(function(o){return o!=null;});}};var E={onMouseWheelScrolling:function(e){var s=this._getScrollExtension();var o=e.originalEvent;var h=o.shiftKey;var d;var f=false;var i=0;if(D.browser.firefox){i=o.detail;}else if(h){i=o.deltaX;}else{i=o.deltaY;}d=i>0;if(h){var g=s.getHorizontalScrollbar();if(d){f=g.scrollLeft===g.scrollWidth-g.clientWidth;}else{f=g.scrollLeft===0;}if(s.isHorizontalScrollbarVisible()&&!f){e.preventDefault();e.stopPropagation();g.scrollLeft=g.scrollLeft+i;}}else{var v=s.getVerticalScrollbar();if(d){f=v.scrollTop===v.scrollHeight-v.clientHeight;}else{f=v.scrollTop===0;}if(s.isVerticalScrollbarVisible()&&!f){e.preventDefault();e.stopPropagation();var r=i/this._getDefaultRowHeight();if(r>1){r=Math.floor(r);}s._bIsScrolledVerticallyByWheel=true;s._bIsScrolledVerticallyByKeyboard=false;v.scrollTop+=r*this._getScrollingPixelsForRow();}}}};var b={ontouchstart:function(e){if(this._isTouchMode(e)){this._aTouchStartPosition=null;this._bIsScrollVertical=null;var $=this._getScrollTargets();var d=q(e.target).closest($).length>0;if(d){var t=e.targetTouches[0];this._aTouchStartPosition=[t.pageX,t.pageY];var v=this._getScrollExtension().getVerticalScrollbar();if(v){this._iTouchScrollTop=v.scrollTop;}var h=this._getScrollExtension().getHorizontalScrollbar();if(h){this._iTouchScrollLeft=h.scrollLeft;}}}},ontouchmove:function(e){if(this._isTouchMode(e)&&this._aTouchStartPosition){var t=e.targetTouches[0];var d=(t.pageX-this._aTouchStartPosition[0]);var i=(t.pageY-this._aTouchStartPosition[1]);if(this._bIsScrollVertical==null){this._bIsScrollVertical=Math.abs(i)>Math.abs(d);}if(this._bIsScrollVertical){var v=this._getScrollExtension().getVerticalScrollbar();if(v){var s=this._iTouchScrollTop-i;if(s>0&&s<(this.getDomRef("vsb-content").clientHeight-v.clientHeight)-1){e.preventDefault();e.stopPropagation();}v.scrollTop=s;}}else{var h=this._getScrollExtension().getHorizontalScrollbar();if(h){var f=this._iTouchScrollLeft-d;if(f>0&&f<(this.getDomRef("hsb-content").clientWidth-h.clientWidth)-1){e.preventDefault();e.stopPropagation();}h.scrollLeft=f;}}}},onAfterRendering:function(e){V.restoreScrollPosition(this);H.restoreScrollPosition(this);},onfocusin:function(e){var $;var f=q(e.target);if(f.parent('.sapUiTableTr').length>0){$=q(this.getDomRef("sapUiTableCtrlScr"));}else if(f.parent('.sapUiTableColHdr').length>0){$=q(this.getDomRef("sapUiTableColHdrScr"));}if((D.browser.firefox||D.browser.chrome)&&$&&$.length>0){var C=$.scrollLeft();var i=$.width();var d=f.position().left;var g=d+f.width();var o=d-C;var O=g-i-C;var h=this._getScrollExtension().getHorizontalScrollbar();if(O>0){h.scrollLeft=h.scrollLeft+O+1;}else if(o<0){h.scrollLeft=h.scrollLeft+o-1;}}}};var c=T.extend("sap.ui.table.TableScrollExtension",{_init:function(t,s,m){this._type=s;this._delegate=b;this._iHorizontalScrollPosition=null;this._iVerticalScrollPosition=null;this._bIsScrolledVerticallyByWheel=false;this._bIsScrolledVerticallyByKeyboard=false;t.addEventDelegate(this._delegate,t);return"ScrollExtension";},_attachEvents:function(){var t=this.getTable();H.addEventListeners(t);V.addEventListeners(t);if(D.browser.firefox){t._getScrollTargets().on("MozMousePixelScroll.sapUiTableMouseWheel",E.onMouseWheelScrolling.bind(t));}else{t._getScrollTargets().on("wheel.sapUiTableMouseWheel",E.onMouseWheelScrolling.bind(t));}},_detachEvents:function(){var t=this.getTable();H.removeEventListeners(t);V.removeEventListeners(t);if(D.browser.firefox){t._getScrollTargets().off("MozMousePixelScroll.sapUiTableMouseWheel");}else{t._getScrollTargets().off("wheel.sapUiTableMouseWheel");}},_debug:function(){this._ExtensionHelper=E;this._ExtensionDelegate=b;this._HorizontalScrollingHelper=H;this._VerticalScrollingHelper=V;},destroy:function(){var t=this.getTable();if(t){t.removeEventDelegate(this._delegate);}this._delegate=null;T.prototype.destroy.apply(this,arguments);},scroll:function(d,p,i){if(d==null){d=false;}if(p==null){p=false;}if(i==null){i=false;}var t=this.getTable();var s=false;var r=t._getRowCount();var v=t.getVisibleRowCount();var e=v-t.getFixedRowCount()-t.getFixedBottomRowCount();var f=t._getSanitizedFirstVisibleRow();var g=p?e:1;if(d){if(f+v<r){t.setFirstVisibleRow(Math.min(f+g,r-v));s=true;}}else if(f>0){t.setFirstVisibleRow(Math.max(f-g,0));s=true;}if(s&&i){this._bIsScrolledVerticallyByKeyboard=true;}return s;},scrollMax:function(d,i){if(d==null){d=false;}if(i==null){i=false;}var t=this.getTable();var s=false;var f=t._getSanitizedFirstVisibleRow();if(d){var F=t._getRowCount()-a.getNonEmptyVisibleRowCount(t);if(f<F){t.setFirstVisibleRow(F);s=true;}}else if(f>0){t.setFirstVisibleRow(0);s=true;}if(s&&i){this._bIsScrolledVerticallyByKeyboard=true;}return s;},getHorizontalScrollbar:function(){var t=this.getTable();if(t!=null){var v=t.getDomRef(S.HorizontalScrollBar);if(v!=null){return v;}}return null;},getVerticalScrollbar:function(){var t=this.getTable();if(t!=null){var v=t.getDomRef(S.VerticalScrollBar);if(v!=null){return v;}}return null;},isHorizontalScrollbarVisible:function(){var t=this.getTable();if(t!=null){var o=t.getDomRef();if(o!=null){return o.classList.contains("sapUiTableHScr");}}return false;},isVerticalScrollbarVisible:function(){var t=this.getTable();if(t!=null){var o=t.getDomRef();if(o!=null){return o.classList.contains("sapUiTableVScr");}}return false;},updateVerticalScrollbarHeight:function(){var t=this.getTable();t.getDomRef(S.VerticalScrollBar).style.maxHeight=t._getVSbHeight()+"px";}});return c;},true);
